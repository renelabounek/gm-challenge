![](https://github.com/neuropoly/gm_challenge/blob/master/doc/logo_challenge.png)

# Spinal Cord Gray Matter Imaging Challenge
Spinal cord gray matter imaging challenge for the [5th Spinal Cord Workshop (June 22<sup>nd</sup> 2018, Paris)](http://www.spinalcordmri.org/2018/06/22/workshop.html).
The objective for this challenge is to propose a protocol that will generate the best image quality. For more details,
please see: https://goo.gl/2owcL7.

## Dependencies

- Python 3.9 with [pandas](https://pandas.pydata.org/) library
- [SCT v5.3.0](https://github.com/spinalcordtoolbox/spinalcordtoolbox/releases/tag/5.3.0).

## Getting started

- Download the dataset of the challenge:
  ~~~
  git clone https://github.com/sct-pipeline/gm-challenge-data
  ~~~
- Download this repository and go in it:
  ~~~
  git clone https://github.com/sct-pipeline/gm-challenge.git
  cd gm-challenge
  ~~~
- Run (you need to have SCT installed):
  ```
  sct_run_batch -script process_data.sh -j -1 -path-data <PATH_DATA> -subject-prefix "" -path-output <PATH_OUT>
  ```
  with
    - PATH_DATA: The path to the downloaded dataset
    - PATH_OUTPUT: The path where results will be output.

## Description of the scripts

* [simu_create_phantom.py](./simu_create_phantom.py): Generate synthetic phantom
of WM and GM that can be used to validate the proposed evaluation metrics. The phantoms are generated with random noise,
 so running the script multiple times will not produce the same output.
This script is meant to be run twice in order to assess the metrics with the following functions.
* [simu_process_data.py](./simu_process_data.py): Process data by batch within
folders. This script will look for csv files, which are generated by
simu_create_phantom.py, and which contain file names of the nifti phantom data.
This script is particularly useful for processing the large amount of files
generated by the phantom construction.
* [simu_make_figures.py](./simu_make_figures.py): Make figures to assess
metrics sensitivity to image quality. Run after simu_process_data.py
* [make_figures_compare_SNR.py](./make_figures_compare_SNR.py): Make figures to assess
the correlation between SNR_single and SNR_diff.

## Analysis

Two NIfTI files are required: an initial scan and a re-scan without repositioning.

### Pre-processing
- The second image is registered to the first in order to compute the SNR using the two-image subtraction method.
- The spinal cord and gray matter of each image are segmented automatically.
- White matter segmentation is generated by subtracting the gray matter segmentation from the cord segmentation.

### Signal-to-noise ratio (SNR):
The SNR is determined with two different methods: SNR_diff and SNR_single.
- SNR_diff is computed with SCT using the two-image subtraction method (Dietrich et al. J Magn Reson Imaging, 2007).
- SNR_single is computed from a single image (Griffanti et al., Biomed Sign Proc and Control, 2012).

### Contrast:
The mean signal is computed in the white matter and gray matter of image 1. The contrast is then computed according to the following equation:

~~~
Contrast = abs(mean(WM) - mean(GM)) / min{mean(WM),mean(GM)}
~~~

## Configuration of Niftyweb server
- make sure the script WMGM is declared in `PATH`
- add an entry to the crontab that points to the Daemon. Example (to edit, use `crontab -e`):
~~~
python /home/niftyweb_sct/gm_challenge/NiftyWeb_setup/daemon_SOFTWEB_2files.py WMGM
~~~

## Contributors
Stephanie Alley, Ferran Prados, Julien Cohen-Adad

## License
See: [LICENSE](./LICENSE)
